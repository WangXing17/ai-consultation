RAG智能问诊助手 - 项目结构
========================================

rag/
│
├── 📄 核心Python模块
│   ├── main.py                    # FastAPI主服务，SSE流式输出
│   ├── config.py                  # 配置管理
│   ├── models.py                  # 数据模型定义
│   ├── knowledge_base.py          # 知识库管理（清洗、切分、向量化）
│   ├── retriever.py               # 多路召回检索器（向量+BM25+规则）
│   └── mcp_tools.py               # MCP工具（Bing搜索兜底）
│
├── 📋 配置文件
│   ├── .env.example               # 环境变量配置模板
│   ├── requirements.txt           # 完整依赖列表
│   └── requirements_minimal.txt   # 最小依赖列表（你缺少的包）
│
├── 📊 数据文件
│   └── data/
│       └── medical_knowledge.json # 示例医疗知识（20条）
│
├── 🌐 网页界面
│   └── static/
│       └── index.html             # 交互式前端界面
│
├── 🔧 工具脚本
│   ├── start.sh                   # 自动启动脚本（推荐使用）
│   ├── install_missing.sh         # 依赖安装脚本
│   └── test_client.py             # Python测试客户端
│
├── 📖 文档
│   ├── README.md                  # 完整项目文档
│   ├── QUICKSTART.md              # 快速启动指南
│   ├── 快速安装命令.md            # 纯命令版本
│   ├── 开始使用.txt               # 快速上手指南
│   └── 项目结构.txt               # 本文件
│
└── 🗑️ 其他
    └── .gitignore                 # Git忽略文件

========================================
核心功能说明
========================================

1. main.py (399行)
   - FastAPI应用主入口
   - SSE流式问诊接口
   - 普通问诊接口
   - 知识库构建和更新接口
   - Redis缓存集成

2. retriever.py
   - 多路召回检索器
   - 路径1：向量检索（Milvus）
   - 路径2：BM25关键词检索
   - 路径3：规则召回
   - LLM智能重排

3. knowledge_base.py
   - 文档加载和清洗
   - 智能文本切分
   - 向量化（OpenAI Embeddings）
   - Milvus入库
   - 增量更新

4. mcp_tools.py
   - Bing搜索工具
   - 自动判断触发条件
   - 知识库兜底

5. static/index.html
   - 美观的对话界面
   - 实时流式响应
   - 知识来源展示
   - 结构化建议展示

========================================
数据流程
========================================

用户问题
    ↓
[main.py] 接收请求
    ↓
[retriever.py] 多路召回检索
    ├─ 向量检索
    ├─ BM25检索
    └─ 规则检索
    ↓
去重 + LLM重排
    ↓
[mcp_tools.py] 判断是否需要Bing搜索
    ↓
构建Prompt + LLM生成
    ↓
SSE流式返回
    ├─ 状态消息
    ├─ 知识来源
    ├─ 回答内容
    └─ 结构化建议
    ↓
Redis缓存（可选）

========================================
技术架构
========================================

┌─────────────────────────────────────┐
│          前端层（static/）           │
│    HTML + JavaScript + SSE          │
└─────────────────────────────────────┘
                 ↓ HTTP
┌─────────────────────────────────────┐
│        服务层（main.py）             │
│    FastAPI + SSE + 缓存管理          │
└─────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────┐
│      检索层（retriever.py）          │
│   多路召回 + 重排 + MCP工具          │
└─────────────────────────────────────┘
         ↓              ↓
┌──────────────┐  ┌──────────────┐
│   Milvus     │  │  Bing Search │
│  (向量数据库) │  │  (MCP兜底)   │
└──────────────┘  └──────────────┘
         ↓
┌─────────────────────────────────────┐
│     OpenAI API（LLM + Embedding）    │
└─────────────────────────────────────┘

========================================
端口使用
========================================

8000  - FastAPI服务
19530 - Milvus向量数据库
6379  - Redis缓存

========================================
关键文件大小（预估）
========================================

main.py              : ~12 KB (399行)
retriever.py         : ~10 KB
knowledge_base.py    : ~8 KB
mcp_tools.py         : ~4 KB
static/index.html    : ~15 KB
medical_knowledge.json : ~25 KB (20条知识)

总计：约75 KB源代码 + 依赖包

========================================
